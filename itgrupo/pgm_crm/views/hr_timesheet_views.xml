<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <record id="hr_timesheet.timesheet_action_all" model="ir.actions.act_window">
        <field name="domain">['|', ('project_id', '!=', False), ('crm_id', '!=', False)]</field>
    </record>

    <record id="hr_timesheet.act_hr_timesheet_line" model="ir.actions.act_window">
        <field name="domain">[ '&amp;', ('user_id', '=', uid), '|', ('project_id', '!=', False), ('crm_id', '!=', False)]</field>
    </record>

    <record id="hr_timesheet_line_pgm_tree" model="ir.ui.view">
        <field name="model">account.analytic.line</field>
        <field name="inherit_id" ref="hr_timesheet.hr_timesheet_line_tree"/>
        <field name="arch" type="xml">
            <xpath expr="//field[@name='project_id']" position="before">
                <field name="crm_id"/>
            </xpath>
        </field>
    </record>

    <record id="view_hr_timesheet_line_pgm_graph" model="ir.ui.view">
        <field name="model">account.analytic.line</field>
        <field name="inherit_id" ref="hr_timesheet.view_hr_timesheet_line_graph"/>
        <field name="arch" type="xml">
            <xpath expr="//field[@name='project_id']" position="before">
                <field name="crm_id"/>
            </xpath>
        </field>
    </record>

    <record id="view_hr_timesheet_line_pgm_graph_my" model="ir.ui.view">
        <field name="model">account.analytic.line</field>
        <field name="inherit_id" ref="hr_timesheet.view_hr_timesheet_line_graph_my"/>
        <field name="arch" type="xml">
            <xpath expr="//field[@name='project_id']" position="before">
                <field name="crm_id"/>
            </xpath>
        </field>
    </record>

    <record id="view_hr_timesheet_line_pgm_graph_all" model="ir.ui.view">
        <field name="model">account.analytic.line</field>
        <field name="inherit_id" ref="hr_timesheet.view_hr_timesheet_line_graph_all"/>
        <field name="arch" type="xml">
            <xpath expr="//field[@name='project_id']" position="before">
                <field name="crm_id"/>
            </xpath>
        </field>
    </record>
    <!-- <record id="view_hr_timesheet_line_pgm_graph_by_employee" model="ir.ui.view">
         <field name="model">account.analytic.line</field>
         <field name="inherit_id" ref="hr_timesheet.view_hr_timesheet_line_graph_by_employee"/>
         <field name="arch" type="xml">
             <xpath expr="//field[@name='project_id']" position="before">
                 <field name="crm_id"/>
             </xpath>
         </field>
     </record>-->

    <record id="hr_timesheet_line_pgm_form" model="ir.ui.view">
        <field name="model">account.analytic.line</field>
        <field name="inherit_id" ref="hr_timesheet.hr_timesheet_line_form"/>
        <field name="arch" type="xml">
            <xpath expr="//field[@name='project_id']" position="before">
                <field name="crm_id" options="{'no_create_edit': True}" required="project_id == False"/>
            </xpath>

            <xpath expr="//field[@name='project_id']" position="attributes">
                <attribute name="required">crm_id == False</attribute>
            </xpath>
        </field>
    </record>

    <record id="hr_timesheet_line_pgm_search" model="ir.ui.view">
        <field name="model">account.analytic.line</field>
        <field name="inherit_id" ref="hr_timesheet.hr_timesheet_line_search"/>
        <field name="arch" type="xml">
            <xpath expr="//field[@name='project_id']" position="before">
                <field name="crm_id"/>
            </xpath>
            <xpath expr="//filter[@name='groupby_project']" position="before">
                <filter string="Oportunidad" name="groupby_crm" domain="[]" context="{'group_by': 'crm_id'}"/>
            </xpath>

        </field>
    </record>

    <record id="view_kanban_account_analytic_line_pgm" model="ir.ui.view">
        <field name="model">account.analytic.line</field>
        <field name="inherit_id" ref="hr_timesheet.view_kanban_account_analytic_line"/>
        <field name="arch" type="xml">
            <xpath expr="//field[@name='project_id']" position="before">
                <field name="crm_id"/>
            </xpath>
            <xpath expr="//div[hasclass('o_kanban_record_headings')]" position="replace">
                <div class="o_kanban_record_headings ps-4 pe-2">
                    <div class="text-truncate">
                        <strong class="o_kanban_record_title">
                            <span t-esc="record.crm_id.value" t-att-title="record.crm_id.value"/>
                            <span t-esc="record.project_id.value" t-att-title="record.project_id.value"/>
                        </strong>
                    </div>
                    <div class="text-truncate">
                        <i>
                            <span t-esc="record.task_id.value" t-att-title="record.task_id.value"/>
                        </i>
                    </div>
                    <div class="text-truncate">
                        <span t-esc="record.name.value" t-att-title="record.name.value"/>
                    </div>
                </div>
            </xpath>

        </field>
    </record>


    <record id="timesheet_view_grid_pgm" model="ir.ui.view">
        <field name="model">account.analytic.line</field>
        <field name="inherit_id" ref="timesheet_grid.timesheet_view_grid"/>
        <field name="arch" type="xml">
            <xpath expr="//field[@name='project_id']" position="before">
                <field name="crm_id" type="row" widget="timesheet_many2one"/>
            </xpath>
        </field>
    </record>


</odoo>


